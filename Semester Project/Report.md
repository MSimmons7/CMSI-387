                                          OS Semester Project - Damage Report
                                          
                                          
Our original intent for our semester project involved modifying the whoami utility. In essence, we wanted to have whoami make calls to the `w` utility, which would then, in turn, return information to the utility level from the kernel in the form of user information. In our “detailed design” document, we wrote, “To do this we will use the `w` command with the options `whoami`, `-h`, and `-s` This will show the information in short form for the current user without the header shown from `w`”. The following is an account of how this ambitious process went.

The first time through, we started our build around 4:30 in the afternoon. For the next three hours, we sat patiently awaiting the results of our efforts. At around 7:30 pm, we had noticed that our build was no longer scrolling rapidly without an apparent end in sight. Maybe it had worked? No, unfortunately, it did not, in fact, work. We were given a message that we had run out of available memory space. We had only had 20 GB available, when we were previously under the incorrect assumption that we had 40 GB available.

Many expletives were thrown around, lives were re-evaluated, and we eventually pulled it together enough to attempt a second build. Again, we sat patiently, waiting on our build. Another three hours or so had passed, when we saw that the build had yet again failed. This time, the build failed due to the fact that it was not being built with root access. Wow-wee, were we steaming at this point.

We had paced back and forth, taking several laps around the room. At this point, it was now around three in the morning. A series of half-asleep/half-awake clicks and key-strokes led to us accidentally doing the dumbest possible thing we could have done. As soon as we saw Michael Simmons type something along the lines of, “Yes, do as I say!” we knew that we were about to do something equal parts drastic and stupid. To put it bluntly, we were about to, well, *damage the kernel*.

Sure enough, we had damaged the kernel. We three geniuses had deleted coreutils on the current installed kernel, and not on the editing one like we had originally thought we were doing. Obviously by now, it was time to call it a day. So after setting up a new VM, we slept on our idiocy, and woke up in the morning with an attitude that was optimistic. Or, well, more along the lines of “how much worse could it get?”

We decided to make some more changes, and go ahead with a third build. We let it go, sat down, and anticipated another three hours that would eventually lead to yet another failed build. To our surprise, we miraculously ended up with a build that had actually built successfully. One problem, however. While we had a successful build, the edit that we made to whoami.c (we had used a syscall to attempt this edit), or at least thought we had made, did not, in fact, work.

We decided to take a break from this series of increasingly demoralizing failures, and accepted the fact that we were going to have to write a report about our inability to achieve our goal that we had set all those weeks ago.

The morning of Monday, April 29th, we decided we couldn’t let ourselves be complete failures. As simple as it was, we decided to try to just add a Hello World syscall to the Linux kernel. Effectively starting from scratch, we downloaded the kernel source and used the sudo tar `-xvf linux-4.17.4.tar.xz -C/usr/src/` command to extract the kernel source code. We then defined a new system call `sys_hello()`, and added `hello/` to the kernel’s Makefile. Next, we added the new system call to the system call table. We then added the new system call to the system call header file. Finally, it was time to compile the kernel, then update the kernel, and then test the system call. Failure after countless failure gave way to a small, but proud, success. We successfully added a Hello World system call to the kernel.

This isn’t the end of the story. In the last hour the night before the project was due we went back and re-evaluated our approach. We realized that we were compiling coreutils where `whoami` is located wrong. We cloned the repo and installed it using the readme from gnu. This build process is much simpler and only takes a few minutes especially with the `make -jn` command that allows for multiple core compilation. We retried with our original edit and it wouldn’t compile. Then we added that same system call to the exit variable and ran it and this time it worked.

Through this process, we learned how the Linux kernel works together and are thankful that coreutils was separated from the main kernel allowing for easy edits. Additionally, we gained a great deal of knowledge on the file structure of Linux and realized how close MacOS is to Linux, something none of us ever realized. This allowed us to finish the project and implement our edit much quicker in the end.
